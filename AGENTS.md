# AGENTS.md - Инструкции для AI Агента (Codex)

## Общие принципы:
- Пиши чистый, хорошо документированный Python код (PEP 8).
- Используй стандартные библиотеки Python везде, где это возможно.
- Для внешних HTTP запросов используй библиотеку `requests`.
- Для работы с архивами используй библиотеку `zipfile`.
- Для управления путями используй `pathlib`.
- Для создания и управления виртуальными окружениями используй модуль `venv` и `subprocess` для вызова pip.
- Обеспечь корректную обработку ошибок (try-except блоки) на каждом этапе.
- Логируй ключевые шаги процесса (скачивание, создание окружения, установка, удаление). Используй стандартный модуль `logging`.
- Все временные файлы и директории должны создаваться в системной временной папке и корректно удаляться.
- Скрипт должен быть идемпотентным в части очистки, если это возможно (т.е. повторный запуск не должен вызывать ошибок, если предыдущая очистка не удалась).

## Структура основного скрипта:
- Основная логика должна быть в функции `main()`.
- Раздели логику на четкие функции для каждого этапа:
    - `get_repo_url_from_env()`: Получение URL из переменной окружения.
    - `download_repo_zip(repo_url, temp_dir)`: Скачивание архива.
    - `extract_repo_zip(zip_path, extract_to_dir)`: Распаковка архива.
    - `find_library_root(extract_to_dir)`: Нахождение корневой папки библиотеки внутри распакованного архива (часто архив содержит папку вида `reponame-branchname`).
    - `create_virtual_env(venv_path)`: Создание виртуального окружения.
    - `install_library_in_venv(venv_path, library_source_path)`: Установка библиотеки.
    - `run_demonstration(venv_path)`: (Опционально) Запуск демонстрационного кода.
    - `cleanup(temp_dir, venv_path)`: Удаление временных файлов и окружения.
- В `if __name__ == "__main__":` вызывай `main()`.

## Специфические требования к этапам:
1.  **Получение URL:** Если переменная окружения не установлена, скрипт должен завершиться с ошибкой и информативным сообщением.
2.  **Скачивание:**
    - URL для скачивания архива обычно имеет вид `https://github.com/USER/REPO/archive/refs/heads/BRANCH_NAME.zip`. Если исходный URL не содержит `/archive/...`, попытайся его сформировать (например, для ветки `main` или `master`). Предусмотри возможность указания ветки в URL или как отдельный параметр/переменную окружения. Для простоты пока можно ожидать URL, который уже указывает на zip-архив или легко трансформируется в него (например, добавляя `/archive/refs/heads/main.zip` к `https://github.com/user/repo`).
    - Сохраняй архив во временную директорию.
3.  **Распаковка:** Распаковывай архив также во временную директорию.
4.  **Создание окружения:** Используй `python -m venv <path_to_venv>`.
5.  **Установка библиотеки:**
    - Используй pip из созданного виртуального окружения: `<path_to_venv>/bin/pip install <path_to_extracted_library_root>` (для Linux/macOS) или `<path_to_venv>/Scripts/pip.exe install <path_to_extracted_library_root>` (для Windows).
    - Убедись, что устанавливаются и зависимости библиотеки (обычно `pip install .` из корня проекта с `setup.py` или `pyproject.toml` это делает).
6.  **Очистка:** Удаляй временную директорию с архивом и распакованными файлами, а также директорию виртуального окружения. Используй `shutil.rmtree`.
